# PhishSense 시스템 보안 가이드라인

본 문서는 시스템 내에 잠재하는 주요 보안 취약점을 방어하기 위한 필수 정책과 구현 지침을 안내합니다.

## 1. 크로스 사이트 스크립팅 (XSS) 방어 정책

PhishSense는 이메일 발송 템플릿과 악성 링크 교육 페이지에서 풍부한 마크업 및 직접적인 HTML 조작 기능을 제공합니다. 이 시스템적 특성에 의해 발생할 수 있는 잠재적 XSS 위험을 방어해야 합니다.

### 입력 정제 (Sanitization) 필수화

모든 사용자가 입력한 HTML(템플릿 편집기 내용 등)은 데이터베이스에 안전하게 보존되거나 화면에 렌더링되기 전에 반드시 서버단에서 정제 과정을 거쳐야 합니다.

- **서버 검증(sanitize-html 활용)**
  - 악의적인 `<script>` 태그나 `on*` 이벤트 핸들러(예: `onload`, `onerror`)가 삽입되는 것을 차단합니다.
  - 인라인 스타일(`style=""`)은 디자인 보존을 위해 일부 허용되지만, 악용될 소지가 있는 프로퍼티는 제외됩니다.
  - 허용되지 않은 비표준 마크업은 자동 필터링됩니다.
- **구현 방식**
  ```typescript
  // shared/sanitizeConfig.ts를 통한 공용 룰셋 적용
  import sanitizeHtml from "sanitize-html";
  const cleanContent = sanitizeHtml(dirtyInput, SANITIZE_OPTIONS);
  ```

### 클라이언트 렌더링 규칙

- React의 기본 동작인 이스케이핑을 최대한 활용하되, 에디터 본문을 뷰어로 출력할 때 불가피하게 사용되는 `dangerouslySetInnerHTML`의 경우 **반드시 서버에서 기 정제된 데이터**만을 사용해야 합니다. 절대 클라이언트-사이드에서 순수 원시 입력을 바인딩해서는 안 됩니다.

## 2. NPM Audit (의존성 보안) 방사형 관리

시스템의 프론트엔드 및 백엔드 오픈소스 패키지가 복합적으로 작용함에 따라, 종속성 버전에 의한 보안 결함(High/Critical Severity)이 발생하지 않도록 상시 관리해야 합니다.

- **주기적 점검**: 패키지 의존성은 수시로 `npm audit`을 통해 감시되며, 취약점이 도출될 경우 즉각적으로 마이너/패치 버전 업데이트를 강제 진행해야 합니다.
- **예외 처리 규칙**: 하위 패키지(예: Drizzle ORM 내부 번들러 등)의 충돌로 인해 즉각적인 버전 오버라이딩이 호환성 파괴를 일으킨다면, 테스트 스위트 (Vitest 등) 전체를 통과하는 선에서 안정화 패치를 구성하고 관련 리포트를 `CHANGELOG` 및 Audit 기록 문서에 별도 보관합니다 (예: `docs/logs/npm-audit-log-*` 참조).
